<?xml version="1.0" encoding="UTF-8"?>
	<modification
        xmlns="https://github.com/vqmod/vqmod"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="https://github.com/vqmod/vqmod https://raw.githubusercontent.com/vqmod/vqmod/master/vqmod.xsd"
        >
		<id>Infinite Scroll</id>
		<version>1.0.0</version>
		<vqmver>2.5.0</vqmver>
		<author>Saqib Ashraf  || support@iextendlabs.com</author>
		
		<file name="catalog/controller/product/category.php">
				<operation>
					<search position="before"><![CDATA[
					$this->response->setOutput($this->load->view('product/category', $data));
					]]></search>
				
					<add><![CDATA[
						$data['module_infinitescroll_status'] = $this->config->get('module_infinitescroll_status');
					]]></add>
				</operation>
		</file>
		<file name="catalog/view/template/product/category.twig">
			<operation>
				<search position="before"><![CDATA[
					{{ footer }}
				]]></search>

				<add><![CDATA[
					{% if module_infinitescroll_status %}
					<div class="loader">
						<div></div>
						<div></div>
						<div></div>
					</div>
					<style>
						#content .pagination{
							display: none;
						}
						/* loader */

						.loader {
							display: inline-block;
							position: relative;
							width: 80px;
							height: 80px;
							opacity: 0;
							margin-left: 650px;
						}


						.loader.show {
							opacity: 1;
						}

						.loader div {
							display: inline-block;
							position: absolute;
							left: 8px;
							width: 16px;
							background: #000000;
							animation: loader 1.2s cubic-bezier(0, 0.5, 0.5, 1) infinite;
						}

						.loader div:nth-child(1) {
							left: 8px;
							animation-delay: -0.24s;
						}

						.loader div:nth-child(2) {
							left: 32px;
							animation-delay: -0.12s;
						}

						.loader div:nth-child(3) {
							left: 56px;
							animation-delay: 0;
						}

						@keyframes loader {
							0% {
							top: 8px;
							height: 64px;
							}

							50%,
							100% {
							top: 24px;
							height: 32px;
							}
						}
					</style>
					<script type="text/javascript">
						$(document).ready(function(){
							var product = $('.product-thumb').length;
							$('#content').find('.row').last().find('div').last().html("Showing 1 to "+product +" Product");
						});
						</script>
						<script type="text/javascript">

						function loadNext(link){
						$('.loader').addClass('show');
						$.get(link, function(data) { 
							$('#content').find('.row').last().remove();
							$('#product-list').append($(data).find('#product-list .col'));
							$('#content').append($(data).find('#content').find('.row').last());

							var product = $('.product-thumb').length;
							$('#content').find('.row').last().find('div').last().html("Showing 1 to "+product +" Product");

							if($('#button-list').hasClass('active'))
							$('#button-list').trigger('click');
							if($('#button-grid').hasClass('active'))
							$('#button-grid').trigger('click');

							$('.loader').removeClass('show');

							});
						}
						var that = $('#content .product-thumb').last();
						function isVisible(that) {
							var elementTop = that.offset().top;
							var elementBottom = elementTop + that.outerHeight();

							var viewportTop = $(window).scrollTop();
							var viewportBottom = viewportTop + $(window).height();

							return elementBottom > viewportTop && elementTop < viewportBottom;
						};


						const visitedLink = [];
						$(window).scroll(function() {
							if(isVisible(that)){
							var next = $("ul.pagination").last().children('.active').next().children('a').attr("href");
							if(next !== undefined){
							if(!visitedLink.includes(next)){
							loadNext(next);
							if(!visitedLink.includes(next)){
								visitedLink.push(next);
							}
							}
							}
							}
						});
					</script>
					{% endif %}
				]]></add>
			</operation>
		</file>
</modification>